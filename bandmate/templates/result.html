<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BandMate â€” Results</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">BandMate</div>
      <div class="badge">Results</div>
    </div>

    {% if error %}
      <div class="card"><h3>Oops!</h3><p>{{ error }}</p>
        <a href="{{ url_for('index') }}"><button class="btn">Back</button></a>
      </div>
    {% endif %}

    {% if extracted_text is not none %}
    <div class="card">
      <form action="{{ url_for('analyze') }}" method="post">
        <input type="hidden" name="task_type" value="{{ task_type }}">
        <input type="hidden" name="student_name" value="{{ student_name }}">
        <input type="hidden" name="teacher_notes" value="{{ teacher_notes }}">
        <input type="hidden" name="w_task" value="1.0">
        <input type="hidden" name="w_coh" value="1.0">
        <input type="hidden" name="w_lex" value="1.0">
        <input type="hidden" name="w_gra" value="1.0">

        <label>Extracted Text (edit before analysis):</label>
        <textarea name="extracted_text" rows="14">{{ extracted_text }}</textarea>

        <div class="actions">
          <button type="submit" class="btn primary">Generate / Regenerate Feedback</button>
          <a href="{{ url_for('index') }}"><button type="button" class="btn ghost">Start Over</button></a>
        </div>
      </form>
    </div>
    {% endif %}

    {% if feedback %}
    <div class="card">
      <h2>Feedback</h2>
      <pre>{{ feedback.summary }}</pre>

      <h3>Band Estimates</h3>
      <ul>
        <li>Task Response/Achievement: <b>{{ feedback.bands.task }}</b></li>
        <li>Coherence & Cohesion: <b>{{ feedback.bands.coherence }}</b></li>
        <li>Lexical Resource: <b>{{ feedback.bands.lexical }}</b></li>
        <li>Grammar Range & Accuracy: <b>{{ feedback.bands.grammar }}</b></li>
        <li>Overall (weighted): <b>{{ feedback.bands.overall }}</b></li>
      </ul>

      <h3>Actionable Suggestions</h3>
      <pre>{{ feedback.actions }}</pre>

      <div class="actions">
        <form action="{{ url_for('download_docx') }}" method="post">
          <input type="hidden" name="student_name" value="{{ student_name }}">
          <input type="hidden" name="task_type" value="{{ task_type }}">
          <input type="hidden" name="extracted_text" value="{{ extracted_text | replace('\n', '&#10;') }}">
          <input type="hidden" name="feedback" value="{{ feedback | tojson }}">
          <button class="btn">Download DOCX</button>
        </form>

        <form action="{{ url_for('download_pdf') }}" method="post">
          <input type="hidden" name="student_name" value="{{ student_name }}">
          <input type="hidden" name="task_type" value="{{ task_type }}">
          <input type="hidden" name="extracted_text" value="{{ extracted_text | replace('\n', '&#10;') }}">
          <input type="hidden" name="feedback" value="{{ feedback | tojson }}">
          <button class="btn">Download PDF</button>
        </form>
      </div>
    </div>
    {% endif %}
  </div>
</body>
</html>

